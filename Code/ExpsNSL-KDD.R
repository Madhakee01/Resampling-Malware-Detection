
library(performanceEstimation) # exps framework
library(UBL)                   # smoteR
library(nnet)                  # neural networks
library(rpart)
library(gbm)

source("Auxs.R")
##############################################################
# THE USED DATA SETS
# ============================================================

load("kddtr.RData")


library(data.table)
library(mltools)

temp <- one_hot(as.data.table(kddtr[,1:41]))

kdd_oh <- cbind(temp, kddtr[,42])
colnames(kdd_oh)[123] <- "Class" 

kddtr <- kdd_oh
##########################################################################
# learners and estimation procedure
##########################################################################

WFs <- list()
WFs$rpart <- list(learner.pars = list(minsplit = c(15, 20, 30), cp = c(0.05, 0.01, 0.005)))
WFs$nnet <- list(learner.pars=list(size=c(1,2,5), decay=c(0, 0.01)))
WFs$gbm <- list(learner.pars=list(n.trees = c(100,200), interaction.depth = c(1), shrinkage = c(0.1)))


# exps with 2 times 10 fold CV

source("EstPredTasks.R")
##########################################################################
# exps
##########################################################################
for(d in 1){
  for(w in names(WFs)) {
    resObj <- paste(myDSs[[d]]@taskName,w,'Res',sep='')
    assign(resObj,
           try(
             performanceEstimation(
               myDSs[[d]],         
               c(
                 do.call('workflowVariants',
                         c(list('WFnone', learner=w),
                           WFs[[w]],
                           varsRootName=paste('WFnone',w,sep='.')
                         ))
                 ,
                 do.call('workflowVariants',
                         c(list('WFRandUnder',learner=w,
                                C.perc=c("balance", "extreme", "mybal"),
                                repl=FALSE),
                           WFs[[w]],
                           varsRootName=paste('WFRandUnder',w,sep='.')
                         ))
                 ,
                 do.call('workflowVariants',
                         c(list('WFGN',learner=w,
                                C.perc=c("balance", "extreme", "mybal"),
                                pert=c(0.01, 0.03, 0.05),
                                repl = TRUE),
                           WFs[[w]],
                           varsRootName=paste('WFGN',w,sep='.')
                         ))
                 ,
                 do.call('workflowVariants',
                         c(list('WFsmote',learner=w,
                                C.perc=c("balance", "extreme", "mybal"),
                                k=c(5, 7), repl=FALSE,
                                dist="HEOM", p=2),
                           WFs[[w]],
                           varsRootName=paste('WFsmote',w,sep='.')
                         )),
                 do.call('workflowVariants',
                         c(list('WFSMOGN',learner=w,
                                C.perc=c("balance", "extreme", "mybal"),
                                k=c(5, 7), repl=FALSE,
                                dist="HEOM", p=2, pert=c(0.01, 0.03, 0.05)),
                           WFs[[w]],
                           varsRootName=paste('WFSMOGN',w,sep='.')
                         ))
               ),
               CVsetts[[d]])
           )
    )
    if (class(get(resObj)) != 'try-error') save(list=resObj,file=paste(myDSs[[d]]@taskName,w,'Rdata',sep='.'))
  }
}


##
#done